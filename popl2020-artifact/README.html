<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>Artifact: Dependent Type Systems as Macros</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">Artifact:<span class="mywbr"> &nbsp;</span> Dependent Type Systems as Macros</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._.Artifact_.Setup_and_.Installation%29" class="tocviewlink" data-pltdoc="x">Artifact Setup and Installation</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._.Artifact_.Overview%29" class="tocviewlink" data-pltdoc="x">Artifact Overview</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="#%28part._examples%29" class="tocviewlink" data-pltdoc="x">Code From the Paper (sections 2-<wbr></wbr>5)</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="#%28part._.Paper_.Section_6__.M.Lish%29" class="tocviewlink" data-pltdoc="x">Paper Section 6:<span class="mywbr"> &nbsp;</span> MLish</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="#%28part._tables%29" class="tocviewlink" data-pltdoc="x">Tables From the Paper</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="#%28part._new%29" class="tocviewlink" data-pltdoc="x">Building New Typed Languages</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._.Artifact__.Dependent_.Type_.Systems_as_.Macros%29" class="tocsubseclink" data-pltdoc="x">Artifact:<span class="mywbr"> &nbsp;</span> Dependent Type Systems as Macros</a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._.Artifact_.Setup_and_.Installation%29" class="tocsubseclink" data-pltdoc="x">Artifact Setup and Installation</a></td></tr><tr><td><span class="tocsublinknumber">1.1<tt>&nbsp;</tt></span><a href="#%28part._vm%29" class="tocsubseclink" data-pltdoc="x">Virtual<span class="mywbr"> &nbsp;</span>Box VM image</a></td></tr><tr><td><span class="tocsublinknumber">1.2<tt>&nbsp;</tt></span><a href="#%28part._manual%29" class="tocsubseclink" data-pltdoc="x">Manual installation</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._.Artifact_.Overview%29" class="tocsubseclink" data-pltdoc="x">Artifact Overview</a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._examples%29" class="tocsubseclink" data-pltdoc="x">Code From the Paper (sections 2-<wbr></wbr>5)</a></td></tr><tr><td><span class="tocsublinknumber">3.1<tt>&nbsp;</tt></span><a href="#%28part._.Paper_section_2__.Creating_a_.Typed_.Language_with_.Racket_and_.Turnstile_%29" class="tocsubseclink" data-pltdoc="x">Paper section 2:<span class="mywbr"> &nbsp;</span> Creating a Typed Language with Racket and Turnstile+</a></td></tr><tr><td><span class="tocsublinknumber">3.2<tt>&nbsp;</tt></span><a href="#%28part._.Paper_section_3%29" class="tocsubseclink" data-pltdoc="x">Paper section 3</a></td></tr><tr><td><span class="tocsublinknumber">3.3<tt>&nbsp;</tt></span><a href="#%28part._.Paper_section_4__core_dependent_calculus%29" class="tocsubseclink" data-pltdoc="x">Paper section 4:<span class="mywbr"> &nbsp;</span> core dependent calculus</a></td></tr><tr><td><span class="tocsublinknumber">3.4<tt>&nbsp;</tt></span><a href="#%28part._.Paper_section_5__.Cur%29" class="tocsubseclink" data-pltdoc="x">Paper section 5:<span class="mywbr"> &nbsp;</span> Cur</a></td></tr><tr><td><span class="tocsublinknumber">3.5<tt>&nbsp;</tt></span><a href="#%28part._.Other_files%29" class="tocsubseclink" data-pltdoc="x">Other files</a></td></tr><tr><td><span class="tocsublinknumber">4<tt>&nbsp;</tt></span><a href="#%28part._.Paper_.Section_6__.M.Lish%29" class="tocsubseclink" data-pltdoc="x">Paper Section 6:<span class="mywbr"> &nbsp;</span> MLish</a></td></tr><tr><td><span class="tocsublinknumber">5<tt>&nbsp;</tt></span><a href="#%28part._tables%29" class="tocsubseclink" data-pltdoc="x">Tables From the Paper</a></td></tr><tr><td><span class="tocsublinknumber">5.1<tt>&nbsp;</tt></span><a href="#%28part._.Table_1__.Summary_of_reuse__visual_%29" class="tocsubseclink" data-pltdoc="x">Table 1:<span class="mywbr"> &nbsp;</span> Summary of reuse (visual)</a></td></tr><tr><td><span class="tocsublinknumber">5.2<tt>&nbsp;</tt></span><a href="#%28part._.Table_2__.Summary_of_reuse__line_counts_%29" class="tocsubseclink" data-pltdoc="x">Table 2:<span class="mywbr"> &nbsp;</span> Summary of reuse (line counts)</a></td></tr><tr><td><span class="tocsublinknumber">5.3<tt>&nbsp;</tt></span><a href="#%28part._.Table_3__.Tests__line_counts_%29" class="tocsubseclink" data-pltdoc="x">Table 3:<span class="mywbr"> &nbsp;</span> Tests (line counts)</a></td></tr><tr><td><span class="tocsublinknumber">6<tt>&nbsp;</tt></span><a href="#%28part._new%29" class="tocsubseclink" data-pltdoc="x">Building New Typed Languages</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="versionNoNav">7.4.0.10</span></div><h2><a name="(part._.Artifact__.Dependent_.Type_.Systems_as_.Macros)"></a>Artifact: Dependent Type Systems as Macros</h2><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">Stephen Chang &lt;<a href="mailto:stchang@ccs.neu.edu">stchang@ccs.neu.edu</a>&gt;,<br/>Michael Ballantyne &lt;<a href="mailto:mballantyne@ccs.neu.edu">mballantyne@ccs.neu.edu</a>&gt;,<br/>Milo Turner &lt;<a href="mailto:turner.mil@husky.neu.edu">turner.mil@husky.neu.edu</a>&gt;,<br/>and William J. Bowman &lt;<a href="mailto:wjb@williamjbowman.com">wjb@williamjbowman.com</a>&gt;</p></span></div><p>This is a README file for the artifact that accompanies "Dependent Type Systems as Macros" in
POPL 2020.  If you have any questions, please email any (or all) of the
authors.</p><p><div class="SIntrapara">Our artifact is a VM image that contains:
</div><div class="SIntrapara"><ul><li><p>a copy of the POPL 2020 submission <a href="file:///home/stchang/macrotypes-cur/popl2020-artifact/paper.pdf">[link]</a>,</p></li><li><p>a distribution of the Racket programming language (v7.4),</p></li><li><p>and the <span class="RktSym">turnstile+</span> library and its documentation.</p></li></ul></div></p><p><div class="SIntrapara">The goals of this artifact are to:
</div><div class="SIntrapara"><ul><li><p>package the library associated with the paper,</p></li><li><p>provide runnable code for each stylized example in the paper,</p></li><li><p>and show how the tables in the paper were computed.</p></li></ul></div></p><h3>1<tt>&nbsp;</tt><a name="(part._.Artifact_.Setup_and_.Installation)"></a>Artifact Setup and Installation</h3><p><div class="SIntrapara">The artifact may be installed in two ways:
</div><div class="SIntrapara"><ul><li><p><a href="#%28part._vm%29" data-pltdoc="x">VirtualBox VM image</a> (recommended)</p></li><li><p><a href="#%28part._manual%29" data-pltdoc="x">Manual installation</a></p></li></ul></div></p><p>The VM image is configured to automatically login to the <span class="stt">artifact</span> user
account. The password for the account is also <span class="stt">artifact</span>. The account has
root privileges using <span class="stt">sudo</span> without a password.</p><p>Skip the rest of this section if you are already reading this document from
within the VM.</p><h4>1.1<tt>&nbsp;</tt><a name="(part._vm)"></a>VirtualBox VM image</h4><p><div class="SIntrapara">The artifact is available as a virtual machine appliance for
<a href="https://www.virtualbox.org/wiki/Downloads">VirtualBox</a>.
</div><div class="SIntrapara"><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>VM appliance:
<a href="http://www.ccs.neu.edu/home/stchang/popl2020/depmacros.ova">[link]</a></p></blockquote></blockquote></blockquote></div></p><p>To run the artifact image, open the downloaded <span class="stt">.ova</span> file using the
<span class="stt">File-&gt;Import Appliance</span> menu item. This will create a new VM
that can be launched after import. We recommend giving the VM at least
2GB of RAM.</p><h4>1.2<tt>&nbsp;</tt><a name="(part._manual)"></a>Manual installation</h4><p>Follow these instructions to manually install the artifact only if
the VirtualBox image is somehow not working.</p><p>(We have only tested these steps with Linux.)</p><ul><li><p>Install <a href="http://download.racket-lang.org">Racket
7.4</a>.</p><p>Add the Racket <span class="stt">bin</span> directory to your <span class="stt">PATH</span>. The
remaining steps assume that Racket&rsquo;s <span class="stt">bin</span> directory is in the
<span class="stt">PATH</span>.</p></li><li><p>Clone the repository into the <span class="stt">popl2020</span> directory (or any directory):</p><p><span class="stt">git clone https://github.com/stchang/macrotypes popl2020</span></p></li><li><p>Change directory to the repository root:</p><p><span class="stt">cd popl2020</span></p></li><li><p>From the repository root, check out the <span class="stt">popl2020-artifact</span> branch:</p><p><span class="stt">git checkout popl2020-artifact</span></p></li><li><p>From the repository root, install Turnstile (may take ~30min-1hr):</p><p><span class="stt">raco pkg install </span>--<span class="stt">auto</span></p></li><li><p>Register the documentation:</p><p><span class="stt">raco setup </span>--<span class="stt">doc-index</span></p></li><li><p>From the repository root, change to the <span class="stt">artifact</span> directory:</p><p><span class="stt">cd popl2020-artifact</span></p></li><li><p>Build the readme:</p><p><span class="stt">make readme</span></p></li><li><p>Open the produced <span class="stt">README.html</span> file.</p></li></ul><h3>2<tt>&nbsp;</tt><a name="(part._.Artifact_.Overview)"></a>Artifact Overview</h3><p>The relevant files are in <a href="file:///home/stchang/macrotypes-cur"><span class="stt">/home/stchang/macrotypes-cur</span></a>.</p><p><div class="SIntrapara">The following files may also be accessed via the VM Desktop:
</div><div class="SIntrapara"><ul><li><p><a href="file:///home/stchang/macrotypes-cur/popl2020-artifact/README.html"><span class="stt">README.html</span></a>: This page</p></li><li><p><a href="file:///home/stchang/macrotypes-cur/popl2020-artifact/paper.pdf"><span class="stt">paper.pdf</span></a>: The camera-ready version of the paper.</p></li><li><p><span class="stt">DrRacket</span>: DrRacket IDE for Racket v7.4</p><p>Run example files by opening them in DrRacket and pressing the "Run" button.</p><p>Alternatively, run files from the command line with <span class="stt">racket</span>:</p><p><span class="stt">racket &lt;Racket filename&gt;</span></p></li></ul></div></p><h3>3<tt>&nbsp;</tt><a name="(part._examples)"></a>Code From the Paper (sections 2-5)</h3><p>For readability and conciseness, the paper presents simplified code that is
stylized with colors and abbreviations. Thus code examples from the paper may
not run as presented. However, runnable versions of the paper&rsquo;s examples are
available in this artifact and are explained in this section.</p><p>Note that code presented in the paper (this section) may differ slightly from
the code used for evaluation (<a href="#%28part._tables%29" data-pltdoc="x">section 5</a>), e.g., in the
quality of their error messages. This artifact always points to the code
being discussed.</p><p>The file links below open in the browser by default. (If not viewing in the VM,
you may need to adjust your browser&rsquo;s "Text Encoding" to display Unicode.) Open
with DrRacket to run the files.</p><h4>3.1<tt>&nbsp;</tt><a name="(part._.Paper_section_2__.Creating_a_.Typed_.Language_with_.Racket_and_.Turnstile_)"></a>Paper section 2: Creating a Typed Language with Racket and Turnstile+</h4><p><div class="SIntrapara"><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020"><span class="stt">/home/stchang/macrotypes-cur/turnstile-example/popl2020</span></a>
</div><div class="SIntrapara"><ul><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020/fig3-left-stlc.rkt"><span class="stt">fig3-left-stlc.rkt</span></a>: Figure 3 (left): STLC, implemented with plain Racket macros.</p><p>See <a href="file:///home/stchang/macrotypes-cur/turnstile-test/tests/popl2020/fig3-left-stlc-tests.rkt"><span class="stt">fig3-left-stlc-tests.rkt</span></a> for examples written with this language.</p></li><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020/fig4-core-api.rkt"><span class="stt">fig4-core-api.rkt</span></a>: Figure 4: Turnstile+ underlying core API. The example in Figure 3 (left) uses the core API in this file.</p></li><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020/fig3-right-stlc.rkt"><span class="stt">fig3-right-stlc.rkt</span></a>: Figure 3 (right): STLC, implemented with Turnstile+.</p><p>See <a href="file:///home/stchang/macrotypes-cur/turnstile-test/tests/popl2020/fig3-right-stlc-tests.rkt"><span class="stt">fig3-right-stlc-tests.rkt</span></a> for examples written with this language.</p></li></ul></div></p><h4>3.2<tt>&nbsp;</tt><a name="(part._.Paper_section_3)"></a>Paper section 3</h4><p><div class="SIntrapara"><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020"><span class="stt">/home/stchang/macrotypes-cur/turnstile-example/popl2020</span></a>
</div><div class="SIntrapara"><ul><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020/fig5-video.rkt"><span class="stt">fig5-video.rkt</span></a></p><p>This is the core of Typed Video from Figure 5.</p><p>It includes the type-level evaluation <span class="RktSym">define-norm</span> definition from Figure 9.</p><p>See <a href="file:///home/stchang/macrotypes-cur/turnstile-test/tests/popl2020/fig5-video-tests.rkt"><span class="stt">fig5-video-tests.rkt</span></a> for examples written with this core language.</p><p><div class="SIntrapara">To define <span class="RktSym">&#8594;vid</span>, <a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020/fig5-video.rkt"><span class="stt">fig5-video.rkt</span></a> uses <span class="RktSym">define-type</span> by default. But the example also works with alternate <span class="RktSym">&#8594;vid</span> definitions:
      </div><div class="SIntrapara"><ul><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020/fig6-right-arrow.rkt"><span class="stt">fig6-right-arrow.rkt</span></a>: Figure 6 (right).</p></li><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020/fig7-right-arrow.rkt"><span class="stt">fig7-right-arrow.rkt</span></a>: Figure 7 (right)</p></li></ul></div></p><p>Uncomment the appropriate line in <a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020/fig5-video.rkt"><span class="stt">fig5-video.rkt</span></a> to use one of these alternate definitions.</p></li><li><p><a href="https://github.com/videolang/typed-video/blob/master/typed/video.rkt">Here is the full implementation of Typed Video</a>. It is based on the core language presented in Figure 5.</p><p>Here is a <a href="https://github.com/videolang/typed-video/tree/master/tests">test suite for Typed Video</a>, including <a href="https://github.com/videolang/typed-video/blob/master/tests/paper-tests.rkt#L281-L295">the <span class="RktSym">mk-conf-talk</span> example from the paper</a> (it uses a slightly different syntax for <span class="RktSym">&#8594;vid</span>).</p></li><li><p><div class="SIntrapara">Here are the Turnstile+ <span class="RktSym">expand/bind</span> and other functions from Figure 8:
     </div><div class="SIntrapara"><ul><li><p><a href="https://github.com/stchang/macrotypes/blob/cur/macrotypes-lib/macrotypes/typecheck-core.rkt#L1132-L1134"><span class="RktSym">expand/bind</span></a>: The <span class="RktSym">norm</span> function from Figure 9, and on the bottom of page 9, is called <span class="RktSym">current-type-eval</span> here.</p></li><li><p><a href="https://github.com/stchang/macrotypes/blob/cur/macrotypes-lib/macrotypes/typecheck-core.rkt#L1092-L1103"><span class="RktSym">env-add</span></a>: Here the calls to <span class="RktSym">syntax-local-bind-syntaxes</span> are (approximately) abbreviated to <span class="RktSym">env-add-m</span> in the paper.</p></li><li><p><a href="https://github.com/stchang/macrotypes/blob/cur/macrotypes-lib/macrotypes/typecheck-core.rkt#L1143-L1154"><span class="RktSym">expand/bind/check</span></a></p></li></ul></div></p></li></ul></div></p><h4>3.3<tt>&nbsp;</tt><a name="(part._.Paper_section_4__core_dependent_calculus)"></a>Paper section 4: core dependent calculus</h4><p><div class="SIntrapara"><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020"><span class="stt">/home/stchang/macrotypes-cur/turnstile-example/popl2020</span></a>
</div><div class="SIntrapara"><ul><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020/fig10-dep.rkt"><span class="stt">fig10-dep.rkt</span></a>: Figure 10 dependent core calculus</p><p>See <a href="file:///home/stchang/macrotypes-cur/turnstile-test/tests/popl2020/fig10-dep-tests.rkt"><span class="stt">fig10-dep-tests.rkt</span></a> for examples written with this core language.</p></li><li><p><div class="SIntrapara">Figure 12: the Turnstile+ type eval library:
</div><div class="SIntrapara"><ul><li><p><a href="https://github.com/stchang/macrotypes/blob/cur/turnstile-lib/turnstile/eval.rkt#L14-L25"><span class="RktSym">reflect</span></a>: called <span class="RktSym">&#8657;</span> in the paper</p></li><li><p><a href="https://github.com/stchang/macrotypes/blob/cur/turnstile-lib/turnstile/eval.rkt#L27-L34"><span class="RktSym">mk-reflected</span></a></p></li><li><p><a href="https://github.com/stchang/macrotypes/blob/cur/turnstile-lib/turnstile/eval.rkt#L36-L72"><span class="RktSym">define-red</span></a></p></li></ul></div></p></li><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020/fig13-sugar.rkt"><span class="stt">fig13-sugar.rkt</span></a></p></li><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020/fig14-nat.rkt"><span class="stt">fig14-nat.rkt</span></a></p></li><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020/fig15-eq.rkt"><span class="stt">fig15-eq.rkt</span></a></p></li><li><p>Figure 16: define-type</p></li><li><p>Figure 17-18: extensions</p></li><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020/fig19-data.rkt"><span class="stt">fig19-data.rkt</span></a></p></li><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020/fig19-data2.rkt"><span class="stt">fig19-data2.rkt</span></a></p></li></ul></div></p><h4>3.4<tt>&nbsp;</tt><a name="(part._.Paper_section_5__.Cur)"></a>Paper section 5: Cur</h4><p><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020"><span class="stt">/home/stchang/macrotypes-cur/turnstile-example/popl2020</span></a></p><ul><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020/exist.rkt"><span class="stt">exist.rkt</span></a>: language with existential
types from figure 13, including <span class="stt">subst</span> and <span class="stt">&#964;=</span>.</p></li><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020/exist-prog.rkt"><span class="stt">exist-prog.rkt</span></a>: the "counter" example
from the paper.</p></li><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020/stlc+sub.rkt"><span class="stt">stlc+sub.rkt</span></a>: language with subtyping
from figure 14; reuses rules from <span class="stt">stlc+prim.rkt</span>.</p></li><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020/stlc+sub-prog.rkt"><span class="stt">stlc+sub-prog.rkt</span></a>: some examples
(not shown in paper) using the <span class="stt">stlc+sub.rkt</span> language.</p></li><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020/fomega.rkt"><span class="stt">fomega.rkt</span></a>: F-omega language from
figure 16.</p></li><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020/fomega-prog.rkt"><span class="stt">fomega-prog.rkt</span></a>: some examples
(not shown in paper) using the <span class="stt">fomega.rkt</span> language.</p></li><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020/effect.rkt"><span class="stt">effect.rkt</span></a>: language with
type-and-effect system from figure 17.</p></li><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020/effect-prog.rkt"><span class="stt">effect-prog.rkt</span></a>: some examples
(not shown in paper) using the <span class="stt">effect.rkt</span> language.</p></li></ul><h4>3.5<tt>&nbsp;</tt><a name="(part._.Other_files)"></a>Other files</h4><p><div class="SIntrapara"><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020"><span class="stt">/home/stchang/macrotypes-cur/turnstile-example/popl2020</span></a>
</div><div class="SIntrapara"><ul><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020/abbrv.rkt"><span class="stt">abbrv.rkt</span></a>: defines abbreviations from
the paper, like <span class="stt">define-m</span>.</p></li><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-example/popl2020/run-all-examples.rkt"><span class="stt">run-all-examples.rkt</span></a>: runs all the
<span class="stt">-prog.rkt</span> example programs.</p></li></ul></div></p><h3>4<tt>&nbsp;</tt><a name="(part._.Paper_.Section_6__.M.Lish)"></a>Paper Section 6: MLish</h3><p>The paper presents simplistic snippets of the MLish language implementation,
optimized for readability. The actual implementation can be found in the files
listed below.</p><p><div class="SIntrapara"><a href="file:///home/stchang/macrotypes-cur/turnstile/examples"><span class="stt">/home/stchang/macrotypes-cur/turnstile/examples</span></a>
</div><div class="SIntrapara"><ul><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile/examples/mlish.rkt"><span class="stt">mlish.rkt</span></a>: MLish language
(no type classes).</p></li><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile/examples/mlish+adhoc.rkt"><span class="stt">mlish+adhoc.rkt</span></a>: MLish language
(with type classes); <span class="stt">define-tc</span> in the paper is
<span class="stt">define-typeclass</span>.</p></li></ul></div></p><p>These implementations fill in the gaps from the paper. The actual
implementations may additionally differ from the paper in other ways, for
example with improved error message reporting and a more efficient type
inference algorithm.</p><p>Feel free to experiment with creating your own MLish program. Look at examples
in the <a href="file:///home/stchang/macrotypes-cur/turnstile/examples/tests/mlish"><span class="stt">tests/mlish</span></a> directory to help get started.</p><p>For example, <a href="file:///home/stchang/macrotypes-cur/turnstile-test/mlish/trees.mlish"><span class="stt">trees.mlish</span></a> and
<a href="file:///home/stchang/macrotypes-cur/turnstile-test/mlish/trees-tests.mlish"><span class="stt">trees-tests.mlish</span></a> contain the trees example from the
paper.</p><h3>5<tt>&nbsp;</tt><a name="(part._tables)"></a>Tables From the Paper</h3><p><div class="SIntrapara">To evaluate Turnstile, we implemented two versions of several example languages:
</div><div class="SIntrapara"><ol><li><p>a version using Racket, as described in Section 3 of the paper.
These implementations can be found at:</p><p><a href="file:///home/stchang/macrotypes-cur/macrotypes/examples"><span class="stt">/home/stchang/macrotypes-cur/macrotypes/examples</span></a></p></li><li><p>a version using Turnstile, as described in Sections 4-6 of the
paper. These implementations can be found at:</p><p><a href="file:///home/stchang/macrotypes-cur/turnstile/examples"><span class="stt">/home/stchang/macrotypes-cur/turnstile/examples</span></a></p></li></ol></div></p><p>The languages in each directory extend and reuse components from each other when
possible.</p><h4>5.1<tt>&nbsp;</tt><a name="(part._.Table_1__.Summary_of_reuse__visual_)"></a>Table 1: Summary of reuse (visual)</h4><p>Table 1 was compiled using the
<a href="file:///home/stchang/macrotypes-cur/macrotypes/examples">Racket implementations</a> (#1 above).
Table 1 remains roughly accurate for the
<a href="file:///home/stchang/macrotypes-cur/turnstile/examples">Turnstile versions</a> (#2), except that
Turnstile defines more things, e.g., <span class="stt">&#964;=</span>, automatically.</p><p>The (Excel) source for Table 1 is at <a href="file:///home/stchang/macrotypes-cur/extension-table.xlsm"><span class="stt">extension-table.xlsm</span></a>. The
VM does not have a local viewer for the file but the file is viewable with
Google Sheets. It is also publicly downloadable from our repository.</p><h4>5.2<tt>&nbsp;</tt><a name="(part._.Table_2__.Summary_of_reuse__line_counts_)"></a>Table 2: Summary of reuse (line counts)</h4><ul><li><p>Column 1: reports the exact line numbers of the
<a href="file:///home/stchang/macrotypes-cur/turnstile/examples">Turnstile implementations</a> (#2 above).</p></li><li><p>Column 2: estimates the number of lines required to implement
each language without reusing any other languages by adding up the lines for
the relevant languages from column 1. Column 2 is an approximation because it
only counts lines from files that were <span style="font-style: italic">entirely</span> needed to implement the
language in question, and excludes files from which only a few lines are reused.</p></li><li><p>Column 3: estimates all the lines of code required by the
<a href="file:///home/stchang/macrotypes-cur/macrotypes/examples">non-Turnstile implementations</a> (#1 above). Since we
did not explicitly implement every permutation of every language, and instead
followed standard software development practices such as moving common
operations to libraries, column 3 was difficult to compute accurately. To get a
rough idea, we simply added all the lines of code in the language implementations and common library
files together.</p></li></ul><p>All line counts include comments and whitespace and all approximate numbers are
rounded to two significant figures. Despite the approximations, this table
remains useful for understanding the degree of reuse achieved by using
Turnstile.</p><p>The numbers in Table 2 may be recomputed by running <a href="file:///home/stchang/macrotypes-cur/compute-table2.rkt"><span class="stt">compute-table2.rkt</span></a>.</p><h4>5.3<tt>&nbsp;</tt><a name="(part._.Table_3__.Tests__line_counts_)"></a>Table 3: Tests (line counts)</h4><ul><li><p>Column 1: number of lines of tests for the core languages, available at:</p><p><a href="file:///home/stchang/macrotypes-cur/turnstile-test"><span class="stt">/home/stchang/macrotypes-cur/turnstile-test</span></a></p><p>Run all (non-MLish) tests by running <a href="file:///home/stchang/macrotypes-cur/turnstile-test/run-all-tests.rkt"><span class="stt">run-all-tests.rkt</span></a>.</p></li><li><p>Column 2: number of lines of tests for MLish, available at:</p><p><a href="file:///home/stchang/macrotypes-cur/turnstile-test/mlish"><span class="stt">/home/stchang/macrotypes-cur/turnstile-test/mlish</span></a></p><p>Run all the MLish tests by running <a href="file:///home/stchang/macrotypes-cur/turnstile-test/run-all-mlish-tests.rkt"><span class="stt">run-all-mlish-tests.rkt</span></a>.</p></li></ul><p>All line counts include comments and whitespace.</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p><div class="SIntrapara">To completely re-compile and re-run all tests (may take ~30-60min):
</div><div class="SIntrapara"><ul><li><p><span class="stt">raco setup -c turnstile macrotypes</span></p></li><li><p><span class="stt">raco setup turnstile macrotypes</span></p></li><li><p><span class="stt">raco test turnstile macrotypes</span></p></li></ul></div></p></blockquote></blockquote></blockquote><p><div class="SIntrapara">Particular files of interest for MLish tests:
</div><div class="SIntrapara"><ul><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-test/mlish/generic.mlish"><span class="stt">generic.mlish</span></a>: example typeclass operations</p></li><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-test/mlish/term.mlish"><span class="stt">term.mlish</span></a>: some tests from
<a href="https://realworldocaml.org/"><span style="font-style: italic">Real-World OCaml</span></a></p></li><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-test/mlish/nbody.mlish"><span class="stt">nbody.mlish</span></a>,
     <a href="file:///home/stchang/macrotypes-cur/turnstile-test/mlish/fasta.mlish"><span class="stt">fasta.mlish</span></a>,
     <a href="file:///home/stchang/macrotypes-cur/turnstile-test/mlish/chameneos.mlish"><span class="stt">chameneos.mlish</span></a>:
some tests from
<a href="http://benchmarksgame.alioth.debian.org/">The Computer Language Benchmarks Game</a></p></li><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-test/mlish/listpats.mlish"><span class="stt">listpats.mlish</span></a>,
     <a href="file:///home/stchang/macrotypes-cur/turnstile-test/mlish/match2.mlish"><span class="stt">match2.mlish</span></a>:
pattern matching tests for lists, tuples, and user-defined datatypes</p></li><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-test/mlish/bg/okasaki.mlish"><span class="stt">okasaki.mlish</span></a>:
tests from <span style="font-style: italic">Purely Functional Data Structures</span></p></li><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-test/mlish/polyrecur.mlish"><span class="stt">polyrecur.mlish</span></a>: polymorphic, recursive
type definitions</p></li><li><p><a href="file:///home/stchang/macrotypes-cur/turnstile-test/mlish/queens.mlish"><span class="stt">queens.mlish</span></a>,
     <a href="file:///home/stchang/macrotypes-cur/turnstile-test/mlish/bg/huffman.mlish"><span class="stt">huffman.mlish</span></a>:
a few other common example programs</p></li></ul></div></p><p>The numbers in Table 3 may be recomputed by running <a href="file:///home/stchang/macrotypes-cur/compute-table3.rkt"><span class="stt">compute-table3.rkt</span></a>.</p><h3>6<tt>&nbsp;</tt><a name="(part._new)"></a>Building New Typed Languages</h3><p>To learn more about <font class="badlink"><span class="RktModLink"><span class="RktSym">turnstile</span></span></font>, view the official
<font class="badlink"><span class="RktModLink"><span class="RktSym">turnstile</span></span></font> documentation.</p><p><font class="badlink">(part ("(lib turnstile/scribblings/turnstile.scrbl)" "The_Turnstile_Guide"))</font>
describes how to build and re-use a new typed language.</p><p><font class="badlink">(part ("(lib turnstile/scribblings/turnstile.scrbl)" "The_Turnstile_Reference"))</font>
describes all the forms provided
by Turnstile.</p></div></div><div id="contextindicator">&nbsp;</div></body></html>